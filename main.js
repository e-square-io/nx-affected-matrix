(()=>{"use strict";var __webpack_modules__={716:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.getInputs=void 0;const inputs_1=__webpack_require__(803);exports.getInputs=function(core){const targets=inputs_1.getStringArrayInput(core,"targets",",");return{...inputs_1.getBaseInputs(core),targets,maxDistribution:inputs_1.getMaxDistribution(core,targets)}}},878:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.main=exports.generateAffectedMatrix=exports.chunkify=void 0;const exec_1=__webpack_require__(420),nx_1=__webpack_require__(510),logger_1=__webpack_require__(980),inputs_1=__webpack_require__(716);function chunkify(arr,numberOfChunks){if(numberOfChunks<2)return[arr];const len=arr.length,result=[];let size,i=0;if(len%numberOfChunks==0)for(size=Math.floor(len/numberOfChunks);i<len;)result.push(arr.slice(i,i+=size));else for(;i<len;)size=Math.ceil((len-i)/numberOfChunks--),result.push(arr.slice(i,i+=size));return result}function generateAffectedMatrix({targets,maxDistribution,args=[]},exec){return logger_1.group(`âš™ï¸ Generating affected matrix for ${targets}`,(async()=>{const matrix={include:[]};for(const target of targets){exec.withArgs(...args),logger_1.debug(`Calculating affected for "${target}" target`);const affectedTargets=chunkify(await nx_1.nxPrintAffected(target,exec),maxDistribution[target]).map(((projects,idx)=>({target,distribution:idx+1,projects:projects.join(",")}))).filter((target=>""!==target.projects));affectedTargets.length&&matrix.include.push(...affectedTargets)}return logger_1.debug(`matrix: ${matrix}`),logger_1.success("Generated affected matrix"),matrix}))}exports.chunkify=chunkify,exports.generateAffectedMatrix=generateAffectedMatrix,exports.main=async function(context,core,exec,io,require){try{const parsedInputs=inputs_1.getInputs(core);await nx_1.assertNxInstalled(new exec_1.Exec(exec.exec));const matrix=await generateAffectedMatrix(parsedInputs,new exec_1.Exec(exec.exec));core.setOutput("matrix",matrix),core.setOutput("hasChanges",!!matrix.include.find((target=>target.projects.length)))}catch(e){core.setFailed(e)}}},420:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.Exec=void 0;const logger_1=__webpack_require__(980);class Exec{constructor(_exec){this._exec=_exec,this.command="",this.options={},this.args=[]}get exec(){return this._exec instanceof Exec?this._exec.exec:this._exec}build(){const command=this.command,coercedArgs=[...this.args],coercedOptions={...this.options};if(!command)throw new Error("No command given to Exec");return this.command="",this.args=[],this.options={},async(args,options)=>{let stdout="",stderr="";const finalArgs=[...coercedArgs,...args??[]].filter((arg=>arg.length>0)).map((arg=>arg.trim())),finalOpts={...coercedOptions,...options,listeners:{stdout:data=>stdout+=data.toString(),stderr:data=>stderr+=data.toString()}};return logger_1.debug(`Running command ${command} - args: ${finalArgs.join(" ")}", options: ${finalOpts}`),this.exec(command,finalArgs,finalOpts).then((code=>{if(0!==code)throw stderr;return stdout}))}}withCommand(command){return this.command=command,this}withArgs(...args){return this.args.push(...args),this}withOptions(options){return this.options={...this.options,...options},this}}exports.Exec=Exec},273:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.tree=exports.GHTree=void 0;const fs_1=__webpack_require__(147),path_1=__webpack_require__(17),logger_1=__webpack_require__(980);class GHTree{constructor(root){this.root=root??process.env.GITHUB_WORKSPACE??process.cwd()}children(dirPath){return fs_1.statSync(this.resolve(dirPath)).isDirectory()?fs_1.readdirSync(this.resolve(dirPath)):[]}delete(filePath){fs_1.rmSync(this.resolve(filePath),{recursive:!0})}exists(filePath){return fs_1.existsSync(this.resolve(filePath))}isFile(filePath){return fs_1.statSync(this.resolve(filePath)).isFile()}listChanges(){return[]}read(filePath,encoding){return fs_1.readFileSync(this.resolve(filePath),{encoding})}async rename(from,to){fs_1.renameSync(this.resolve(from),path_1.resolve(this.root,to))}write(filePath,content){fs_1.writeFileSync(this.resolve(filePath),content)}resolve(path){return path_1.resolve(this.root,path)}getLockFilePath(){const lockFile=["package-lock.json","yarn.lock","pnpm-lock.yaml","pnpm-lock.yml"].find((file=>this.exists(file)));if(lockFile)return this.resolve(lockFile);logger_1.info("Couldn't find any lock file")}changePermissions(filePath,mode){fs_1.chmodSync(exports.tree.resolve(filePath),mode)}}exports.GHTree=GHTree,exports.tree=new GHTree},803:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBaseInputs=exports.getMaxDistribution=exports.getStringArrayInput=void 0;const logger_1=__webpack_require__(980);function getStringArrayInput(core,name,separator=" ",options){return core.getInput(name,options).split(separator).filter((value=>value.length>0))}exports.getStringArrayInput=getStringArrayInput,exports.getMaxDistribution=function(core,targets,name){const value=name?core.getInput(name):core.getInput("maxDistribution")||core.getInput("maxParallel"),coercedTargets=[].concat(targets),maybeNumberValue=parseInt(value),reduceTargetsDistribution=source=>coercedTargets.reduce(((acc,curr,idx)=>{let targetVal="object"==typeof source?Array.isArray(source)?source[idx]:source[curr]:source;return(null==targetVal||isNaN(targetVal)||targetVal<=0)&&(logger_1.warning(new Error(`Received invalid value for ${name} input: '${targetVal}' for target '${curr}', using the default instead`)),targetVal=3),{...acc,[curr]:targetVal}}),{});if(isNaN(maybeNumberValue))try{return reduceTargetsDistribution(JSON.parse(value))}catch{logger_1.warning(new Error(`Couldn't parse '${value}' as a valid JSON object, using default value for ${name}`))}return reduceTargetsDistribution(maybeNumberValue)},exports.getBaseInputs=function(core){const debug=core.getBooleanInput("debug"),workingDirectory=core.getInput("workingDirectory");return logger_1.logger(core).debugMode=debug,workingDirectory?.length>0&&(logger_1.log(`ðŸƒ Working in custom directory: ${workingDirectory}`),process.chdir(workingDirectory)),{args:getStringArrayInput(core,"args"),debug,workingDirectory}}},980:(__unused_webpack_module,exports)=>{let _logger;Object.defineProperty(exports,"__esModule",{value:!0}),exports.group=exports.error=exports.warning=exports.notice=exports.debug=exports.success=exports.info=exports.log=exports.logger=exports.initializeLogger=void 0;class Logger{constructor(core){this.core=core,this._debugMode=!1}set debugMode(value){this._debugMode=value}get debugMode(){return this._debugMode}log(message){this.core.info(message)}info(message){this.log(`â• ${message}`)}success(message){this.log(`âœ… ${message}`)}debug(message){this.debugMode&&!this.core.isDebug()&&this.log(`ðŸž ${message}`),this.core.debug(`ðŸž ${message}`)}notice(message,properties){this.core.notice(message,properties)}warning(message,properties){this.core.warning(message,properties)}error(message,properties){this.core.error(message,properties)}async group(name,cb){return await this.core.group(name,cb)}}function initializeLogger(core){_logger=new Logger(core)}exports.initializeLogger=initializeLogger;exports.logger=core=>{if(!_logger){if(!core)throw"logger is not initialized";initializeLogger(core)}return _logger},exports.log=function(message){exports.logger().log(message)},exports.info=function(message){exports.logger().info(message)},exports.success=function(message){exports.logger().success(message)},exports.debug=function(message){exports.logger().debug(message)},exports.notice=function(message,properties){exports.logger().notice(message,properties)},exports.warning=function(message,properties){exports.logger().warning(message,properties)},exports.error=function(message,properties){exports.logger().error(message,properties)},exports.group=async function(name,cb){return await exports.logger().group(name,cb)}},949:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.getNpmVersion=void 0;const exec_1=__webpack_require__(420);exports.getNpmVersion=function(exec){return new exec_1.Exec(exec).withCommand("npm -v").build()()}},510:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.nxRunMany=exports.nxPrintAffected=exports.nxCommand=exports.assertNxInstalled=exports.getProjectOutputs=exports.getWorkspaceProjects=void 0;const fs_1=__webpack_require__(273),logger_1=__webpack_require__(980),npm_1=__webpack_require__(949);async function nxCommand(command,target,exec,args){const npxVersion=(await npm_1.getNpmVersion(exec)).split(".");return exec.withCommand(`npx ${+npxVersion[0]>6?"--no ":""}-p @nrwl/cli nx ${command}`).withArgs(`--target=${target}`,...args).build()()}exports.getWorkspaceProjects=function(){const workspaceFile=fs_1.tree.exists("angular.json")?"angular.json":"workspace.json";logger_1.debug(`Found ${workspaceFile} as nx workspace`);const workspaceContent=JSON.parse(fs_1.tree.read(workspaceFile).toString().replace(/architect/g,"targets")),projectKeys=Object.keys(workspaceContent.projects||{}),projects={};for(const key of projectKeys){const project=workspaceContent.projects[key];projects[key]="string"==typeof project?JSON.parse(fs_1.tree.read(`${project}/project.json`).toString().replace(/architect/g,"targets")):project}return projects},exports.getProjectOutputs=function(projects,project,target){const projectTarget=projects[project].targets[target],resolvedOutputs=(projectTarget.outputs??[]).map((path=>{if(!path.includes("{")||!path.includes("}"))return path;const[scope,prop]=path.replace(/[{}]/g,"").split(".");return projectTarget?.[scope]?.[prop]?projectTarget?.[scope]?.[prop]??"":(logger_1.warning(new Error(`Couldn't find output value for ${project}. full path: project.${project}.targets.${target}.${scope}.${prop}`)),"")}));return logger_1.debug(`Found ${resolvedOutputs} as outputs for ${target}`),resolvedOutputs},exports.assertNxInstalled=async function(exec){logger_1.debug("Checking existence of nx");const path=await exec.withCommand("npm ls @nrwl/cli -p --depth 1").build()();if(logger_1.debug(`NX bin path: ${path}`),!path)throw new Error("Couldn't find Nx binary, Have you run npm/yarn install?")},exports.nxCommand=nxCommand,exports.nxPrintAffected=async function(target,exec){const projects=(await nxCommand("print-affected",target,exec,["--select=tasks.target.project"])).trim();return logger_1.debug(`Affected project for ${target}: ${projects}`),projects.split(", ")},exports.nxRunMany=async function(context,target,inputs,exec){const args=inputs.args??[];if(inputs.nxCloud){args.push("--scan");const env={};env.NX_RUN_GROUP=context.runId.toString(),"pull_request"===context.eventName&&(env.NX_BRANCH=context.payload.pull_request.number.toString()),exec.withOptions({env:{...process.env,...env}})}return args.push("--parallel",`--maxParallel=${inputs.maxParallel||3}`),logger_1.logger().debugMode?(logger_1.debug("Debug mode is on, skipping target execution"),Promise.resolve("[DEBUG MODE] skipping execution")):nxCommand("run-many",target,exec,args)}},147:module=>{module.exports=require("fs")},17:module=>{module.exports=require("path")}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}var __webpack_exports__={};(()=>{var exports=__webpack_exports__;Object.defineProperty(exports,"__esModule",{value:!0});const nx_affected_matrix_1=__webpack_require__(878);exports.default=async function(context,core,exec,io,require){await nx_affected_matrix_1.main(context,core,exec,io,require)}})();var __webpack_export_target__=exports;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();